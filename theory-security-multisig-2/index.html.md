 

Это вторая статья из нашей серии о мультиподписи. Первую часть читайте здесь: 

<figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://www.21ideas.org/theory-security-multisig-1/"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Мультисиг. Часть I</div><div class="kg-bookmark-description">Основным преимуществом мультисиг является то, что эта схема создает дополнительные ступени в управлении ключами</div><div class="kg-bookmark-metadata"><img alt="" class="kg-bookmark-icon" src="https://www.21ideas.org/favicon.png"/><span class="kg-bookmark-author">21ideas</span><span class="kg-bookmark-publisher">Tony Lightninng</span></div></div><div class="kg-bookmark-thumbnail"><img alt="" src="https://www.21ideas.org/content/images/2022/01/multisig.gif"/></div></a></figure>

Прежде чем погрузиться в технические детали функционирования адресов и кошельков с мультиподписью (мультисиг), важно иметь базовое представление о том, как функционируют кошельки с одной подписью – наиболее распространенный вид биткоин-кошельков. Большинство общих технических деталей, применимых к кошелькам с одной подписью, применимы и к мультисиг-кошелькам (кошелькам с несколькими подписями), но кошельки с одной подписью, как правило, объединяют несколько этапов и функций, в то время как кошельки с несколькими подписями обычно разделяют эти этапы. Для начала предлагаем разобраться, что такое биткоин-кошелек.

<h1 id="%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%B1%D0%B8%D1%82%D0%BA%D0%BE%D0%B8%D0%BD-%D0%BA%D0%BE%D1%88%D0%B5%D0%BB%D0%B5%D0%BA">Что такое биткоин-кошелек?</h1>

Термин "кошелек" не является самым точным отражением функций, выполняемых этим инструментом в мире Биткоина. Когда люди обычно думают о биткоин-кошельке, распространенным предположением является то, что биткоин живет в программном или аппаратном решении (“кошельке”), подконтрольном пользователю. В действительности кошельки хранят и координируют ключи, которые затем могут быть использованы для взаимодействия с монетами на адресах, отслеживаемых блокчейном.

<figure class="kg-card kg-image-card kg-card-hascaption"><img alt="" class="kg-image" loading="lazy" src="https://lh6.googleusercontent.com/sWG664D44Thu94VKAfHPim7kn3FR6sTg-GaWhmO2zLjcdSsk2l_rJMt6DIkFiZo1NESDx2UakZnPSnye_3XLy7E6Au0Q4ggVlq29wyfgbLbvmFbM2N07TntQfyKpx_A1D9dgtPKb"/><figcaption><em>Функции типичного кошелька разбиты на этапы.</em></figcaption></figure>

"Кошелек" используется для описания программного или аппаратного обеспечения, которое выполняет некоторые или все следующие задачи:

__Консенсус__ – синхронизирует данные об уже добытых блоках, а также о текущем наборе [UTXO](https://t.me/bitcoin21ideas/151) и состоянии [мемпула](https://t.me/bitcoin21ideas/279) с остальной частью сети.

__Координация__ – рассчитывает и отображает балансы, создает транзакции, производит запросы на подпись.

__Хранение ключей__ – хранит данные [приватных ключей](https://www.21ideas.org/theory-security-bitcoin-wallets/), экспортирует публичные ключи, подписывает транзакции.

Некоторые кошельки выполняют все эти функции. Само программное обеспечение [Bitcoin Core](https://bitcoin.org/en/bitcoin-core/), как первый из созданных биткоин-кошельков, выполняет все три задачи. Другие кошельки, такие как [Electrum](https://electrum.org/#home), поддерживают собственный консенсус через сеть серверов Electrum, координируют транзакции и балансы и даже могут хранить программные ключи.

Мобильный кошелек, такой как [Samourai](https://samouraiwallet.com/), является одновременно координатором и хранилищем ключей. Приложение Samourai хранит приватные ключи на вашем мобильном устройстве и координирует ваши транзакции и баланс. Консенсус передается на аутсорсинг программному обеспечению Bitcoin Core, либо путем подключения к вашему собственному полному узлу, либо к одному из узлов Samourai.

Некоторые компании предлагают продукты, которые в совокупности представляют собой полноценный кошелек. Например, аппаратный кошелек [Trezor](https://trezor.io/) является специализированным аппаратным хранилищем ключей. Для функционирования аппаратный кошелек должен взаимодействовать с веб-сайтом Trezor, который является координатором. Собственные серверы SatoshiLabs обеспечивают консенсус благодаря работе программного обеспечения Bitcoin Core.

<h1 id="%D0%BE%D0%B4%D0%B8%D0%BD%D0%BE%D1%87%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C">Одиночная подпись</h1>

Во всех приведенных выше примерах по умолчанию используются адреса с одиночной подписью. Единая подпись означает, что для создания подписи и трансляции транзакции биткоина требуется только один ключ. Если хотите провести аналогию, представьте, что подпись – это единоразовое действие ключа, используемого для запуска автомобиля, а трансляцию транзакции можно представить как езду на автомобиле.

Для примера в контексте Биткоина, отдельный Trezor (хранилище ключей), подключенный к wallet.trezor.io (координатор), может в одностороннем порядке перемещать средства, находящиеся по адресу, который контролируется одним из закрытых ключей, хранящихся на Trezor. Кошельки с одной подписью наиболее полезны для совершения частых, ежедневных транзакций, применения технологий повышения приватности, таких как [CoinJoin](https://www.21ideas.org/privacy-coinjoin/), или для перемещения средств в сети Lightning.

Думая о биткоин-кошельке, большинство представляет себе одно аппаратное устройство (то есть хранилище ключей), способное подписывать транзакции, поскольку это наиболее близкая ассоциация с банковским счетом в традиционной финансовой системе, или на подсознательном уровне это ближе к физическому бумажнику, хранящему ваши купюры. Однако, обозначив три отдельные выполняемые кошельком функции (консенсус, координация, хранение ключей), биткоинеры могут лучше понять, что на самом деле происходит, когда они создают биткоин-транзакции.

<h1 id="%D0%B3%D0%B4%D0%B5-%D1%85%D1%80%D0%B0%D0%BD%D1%8F%D1%82%D1%81%D1%8F-%D0%BD%D0%B0%D1%88%D0%B8-%D1%81%D0%B0%D1%82%D1%8B">Где хранятся наши саты?</h1>

<figure class="kg-card kg-image-card"><img alt="" class="kg-image" loading="lazy" src="https://lh3.googleusercontent.com/PvPkbgeGdumfLpb7ZyzcEp7f3Kh0MbrALd6YL2ysfXEaNpY_NLaOLKseIFyu6eebZOCtr0JdsyKeN9e8_gIEi7aT2pzWXTcx3YB6YB4RuPxJJ30pp5YWI415z0XBvPUV7R7TJApJ"/></figure>

Ни в какой момент времени биткоин не "хранится" на аппаратном устройстве. Аппаратное устройство просто хранит коллекцию ключей, которые могут санкционировать расходование биткоина, что отслеживается по выходам неизрасходованных транзакций (UTXO), расположенным по адресам, отслеживаемым блокчейном. Блокчейн живет на тысячах компьютеров, распределенных по всему миру. Ваш биткоин "живет" в блокчейне; ваше аппаратное устройство хранит _ключи_ (не биткоин), но эти ключи необходимы для передачи биткоина. А _кошелек_ – это пользовательский интерфейс для взаимодействия с _адресами_, которые находятся под контролем приватных ключей, координируемых программным или аппаратным обеспечением.

В кошельке с одной подписью ключи очень важно защищать и держать в секрете, поскольку адреса генерируются таким способом, что ваши адреса могут быть относительно легко обнаружены, если ваш приватный ключ будет скомпрометирован. Таким образом, отдельные ключи (и резервные копии) становятся единой точкой отказа в кошельках с одной подписью.

Современные адреса с мультиподписью защищают от этого, устраняя опасность в виде единой точки отказа, по крайней мере, в схемах _m-из-n_, где _n_ больше единицы. Мультисиг разрывает связь отдельных ключей с адресами. Адрес можно узнать, только если известны все отдельные публичные ключи, составляющие его, поскольку публичные ключи криптографически связаны между собой алгоритмом. В качестве ментальной модели, представьте, что современный мультисиг разделяет карту местонахождения сундука с сокровищами и ключи, которые открывают этот сундук. Если найдена только часть ключей, у противника нет возможности узнать, где находится сам сундук. Если карта сокровищ найдена, но у злоумышленника нет достаточного количества ключей, чтобы открыть сундук с сокровищами, у него также нет возможности заполучить содержимое.

<h1 id="%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4-%D0%BD%D0%B0-%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D1%81%D0%B8%D0%B3">Переход на мультисиг</h1>

Мы надеемся, что эта статья пролила свет на то, что происходит под капотом биткоин-кошельков. Это критически важный фундамент, заложив который мы сможем обсудить практическую сторону мультисиг. В следующих статьях мы поделимся более подробной информацией об этой схеме.

---

Статья подготовлена командой Unchained Capital. [Оригинал](https://unchained.com/blog/single-signature-wallet/).  